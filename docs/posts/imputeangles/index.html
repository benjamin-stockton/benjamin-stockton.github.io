<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ben Stockton">
<meta name="dcterms.date" content="2024-02-21">

<title>How to Use imputeangles – Ben Stockton’s Stats Site</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="How to Use imputeangles – Ben Stockton’s Stats Site">
<meta property="og:description" content="">
<meta property="og:site_name" content="Ben Stockton's Stats Site">
<meta name="twitter:title" content="How to Use imputeangles – Ben Stockton’s Stats Site">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ben Stockton’s Stats Site</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">—</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/benjamin-stockton"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/benjamin-stockton-329507160/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">How to Use imputeangles</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Ben Stockton </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 21, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#multiple-imputation" id="toc-multiple-imputation" class="nav-link active" data-scroll-target="#multiple-imputation">Multiple Imputation</a></li>
  <li><a href="#pitch-movement" id="toc-pitch-movement" class="nav-link" data-scroll-target="#pitch-movement">Pitch Movement</a></li>
  <li><a href="#loading-pitch-data" id="toc-loading-pitch-data" class="nav-link" data-scroll-target="#loading-pitch-data">Loading Pitch Data</a></li>
  <li><a href="#imputing-incomplete-pitch-data" id="toc-imputing-incomplete-pitch-data" class="nav-link" data-scroll-target="#imputing-incomplete-pitch-data">Imputing Incomplete Pitch Data</a></li>
  <li><a href="#logistic-regression-glmm-with-lme4" id="toc-logistic-regression-glmm-with-lme4" class="nav-link" data-scroll-target="#logistic-regression-glmm-with-lme4">Logistic Regression GLMM with lme4</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>In this post, I will provide a brief introduction to using multiple imputation (MI) and then share an example analysis of pitch movement using my <code>imputeangles</code> package.</p>
<p>Most statistical analysis methods are designed with complete data in mind, however, real-world data is often incomplete with observations missing due to nonresponse, censoring, or measurement issues. The incomplete data cannot be directly analyzed with the complete data statistical methods. While there are specialized methods designed to model incomplete data, due to the convenience and wide availability of complete data methods it would be highly beneficial to complete the incomplete data. This could be accomplished by removing incomplete cases and performing complete case analysis (CCA), but this could throw out lots of useful data <span class="citation" data-cites="schafer2002">(<a href="#ref-schafer2002" role="doc-biblioref">Joseph L. Schafer and Graham 2002</a>)</span>.</p>
<section id="multiple-imputation" class="level2">
<h2 class="anchored" data-anchor-id="multiple-imputation">Multiple Imputation</h2>
<p>Imputation is the process of replacing the missing values with values deterministically calculated by the observed data or with values drawn from a probability distribution shaped by the observed data. Two common, but not theoretically valid, ways to do this are mean imputation (replace with the sample mean or regression predicted values) <span class="citation" data-cites="schafer1999multiple">(<a href="#ref-schafer1999multiple" role="doc-biblioref">Joseph L. Schafer 1999</a>)</span> or last observation carried forward (LOCF) for time series or longitudinal data <span class="citation" data-cites="moritz2022">(<a href="#ref-moritz2022" role="doc-biblioref">Moritz et al. 2022</a>)</span>. These methods are performed a single time to create a singly imputed (SI) data set. Alternatively, we could impute the missing values with random draws from the observed data or from a predictive distribution based on the observed data. These imputations are worse in terms of providing accurate predictions for the missing value, however, they do reflect the uncertainty of the missing value. Repeatedly imputing the missing values to create multiple imputed data sets can propagate the uncertainty to the analysis.</p>
<p>This process is called by Multiple Imputation (MI) and was initially developed by Donald Rubin in the 1970s and 1980s for nonresponse in surveys <span class="citation" data-cites="rubin1978">Rubin (<a href="#ref-rubin1987" role="doc-biblioref">1987</a>)</span>, and then extended to more analysis contexts since the 1990s <span class="citation" data-cites="li2006analysis">Harel (<a href="#ref-harel2003strategies" role="doc-biblioref">2009</a>)</span>. The foundation of MI is a three stage process.</p>
<ol type="1">
<li><p>Impute - Fill in the missing values with random samples from a predictive distribution (posterior predictive draws theoretically preferred) to create <span class="math inline">\(M\)</span> completed data sets.</p></li>
<li><p>Analyze - Analyze each of the <span class="math inline">\(M\)</span> data sets with a complete data method to estimate a quantity of interest <span class="math inline">\(Q\)</span> using estimate <span class="math inline">\(\hat{Q}_m\)</span> and its squared standard error <span class="math inline">\(U_m = SE(\hat{Q})^2\)</span>.</p></li>
<li><p>Combine - Use Rubin’s Rules to combine the estimates and variances to perform inference on the quantity of interest <span class="math inline">\(Q\)</span>.</p>
<span class="math display">\[\begin{align*} \label{eq-rubins-rules}
    \bar{Q} &amp;= \frac{1}{M} \sum_{m=1}^M \hat{Q}_m \\
    \bar{U} &amp;= \frac{1}{M} \sum_{m=1}^M U_m \\
    B &amp;= \frac{1}{M-1} \sum_{m=1}^M (\hat{Q}_m - \bar{Q})^2 \\
    T &amp;= \bar{U} + (1 + \frac{1}{M}) B
\end{align*}\]</span></li>
</ol>
<p>Under a set of assumptions<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, the inferences produced by MI will be unbiased, more efficient than CCA, and confidence valid. Rubin’s rules have been developed for sample means, sample mean differences, regression coefficients, correlation coefficients, and more <span class="citation" data-cites="buuren2018">(<a href="#ref-buuren2018" role="doc-biblioref">Stef van Buuren 2018, sec. 5.2</a>)</span>.</p>
</section>
<section id="pitch-movement" class="level2">
<h2 class="anchored" data-anchor-id="pitch-movement">Pitch Movement</h2>
<p>In baseball, highly-skilled pitchers are able to impart different rates and axis of spin on the pitched ball resulting in varying movements (or lack thereof) on the pitch as it travels to the catcher. Modeling these characteristics has been a central development to coaching pitchers in the past decade<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. In the following illustrative analysis, we’ll use pitch-level data collected by MLB to predict whether a non-batted pitch will be swung at and missed.</p>
</section>
<section id="loading-pitch-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-pitch-data">Loading Pitch Data</h2>
<div class="cell" data-hash="index_cache/html/load-pitch-data-no-run_41e64dc5395dfb016c564cc6ae3ade89">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Amelia)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(imputeangles)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>peralta_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Peralta"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">first_name =</span> <span class="st">"Freddy"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>burnes_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Burnes"</span>, </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">first_name =</span> <span class="st">"Corbin"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>miley_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Miley"</span>, </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">first_name =</span> <span class="st">"Wade"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>rea_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Rea"</span>, </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">first_name =</span> <span class="st">"Colin"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>teheran_id <span class="ot">&lt;-</span> <span class="dv">527054</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>houser_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Houser"</span>, </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">first_name =</span> <span class="st">"Adrian"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>woodruff_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Woodruff"</span>, </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">first_name =</span> <span class="st">"Brandon"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>ids_list <span class="ot">&lt;-</span> <span class="fu">list</span>(peralta_id, burnes_id, rea_id, houser_id, </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                 miley_id, teheran_id, woodruff_id)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># pitches &lt;- readr::read_csv()</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>pitches <span class="ot">&lt;-</span> <span class="fu">lapply</span>(ids_list, <span class="cf">function</span>(id) {</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    baseballr<span class="sc">::</span><span class="fu">statcast_search</span>(<span class="at">start_date =</span> <span class="st">"2023-03-01"</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                               <span class="at">end_dat =</span> <span class="st">"2023-10-31"</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                               <span class="at">player_type =</span> <span class="st">"pitcher"</span>, <span class="at">playerid =</span> id)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        game_date, pitcher, batter, game_type, home_team, away_team, </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>       pitch_type, type, release_speed, release_spin_rate, release_extension,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>       spin_axis, release_pos_x, release_pos_z, plate_x, plate_z,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>       player_name, events, description, launch_angle, launch_speed</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        game_type <span class="sc">==</span> <span class="st">"R"</span>, </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        type <span class="sc">!=</span> <span class="st">"X"</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">spin_axis =</span> spin_axis <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">360</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_spin =</span> <span class="fu">cos</span>(spin_axis),</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_spin =</span> <span class="fu">sin</span>(spin_axis),</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_2spin =</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>spin_axis),</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_2spin =</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>spin_axis),</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">strike =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>            type <span class="sc">==</span> <span class="st">"S"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>            type <span class="sc">==</span> <span class="st">"B"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>game_type)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(pitches, <span class="st">"data/brewers_sp_2023_pitches.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/fig-miss-map_70cdbbd8318ef3665629ca71ed776c97">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pitches <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        pitch_type, release_speed, release_spin_rate, spin_axis,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        release_extension, plate_x, plate_z  </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    VIM<span class="sc">::</span><span class="fu">matrixplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-miss-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-miss-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-miss-map-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-miss-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Missinginess matrix plot where red indicates missingness in that observation.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We’ll take a look at an example of how to perform MI in practice in comparison to CCA. We have a data set of <span class="math inline">\(N =\)</span> 10544 caught pitches (swing and called strikes, balls, or hit by pitches) pitches from the 2023 MLB season with measurements for the pitch outcome, pitch velocity and spin direction and rate at release, release point, horizontal and vertical break, location at the plate, as well as the identity of the batter, pitcher, and ballpark. We will model the pitch outcome based on the other measurements while using random effects for the batter, pitcher, and ballpark. In this analysis our quantity of interest is the effect of spin rate <span class="math inline">\(\beta_{SpinRate}\)</span> on the pitch outcome given the pitch was not fouled off or put in play which will be estimated using a mixed effects logistic regression model.</p>
<div class="cell" data-hash="index_cache/html/pitches-thrown-norun_6f72abb74a9142b014a5d2676006a60e">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pitches <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(player_name) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n_pitches =</span> <span class="fu">n</span>(),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_fastball =</span> <span class="fu">sum</span>(pitch_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FC"</span>, <span class="st">"FF"</span>, <span class="st">"FS"</span>, <span class="st">"SI"</span>)),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_offspeed =</span> <span class="fu">sum</span>(pitch_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CH"</span>, <span class="st">"CU"</span>, <span class="st">"SL"</span>, <span class="st">"ST"</span>)),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_missing =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(pitch_type))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/tbl-pitches-thrown_6ced5887488548aea5a0e74edc4d196f">
<div id="tbl-pitches-thrown" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-hash="index_cache/html/tbl-pitches-thrown_6ced5887488548aea5a0e74edc4d196f">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pitches-thrown-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Number of pitches thrown by each starting pitcher.
</figcaption>
<div aria-describedby="tbl-pitches-thrown-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Pitches</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Fastball</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Offspeed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N Missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Burnes, Corbin</td>
<td style="text-align: right;">2569</td>
<td style="text-align: right;">1583</td>
<td style="text-align: right;">986</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Houser, Adrian</td>
<td style="text-align: right;">1506</td>
<td style="text-align: right;">1005</td>
<td style="text-align: right;">427</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Miley, Wade</td>
<td style="text-align: right;">1506</td>
<td style="text-align: right;">1040</td>
<td style="text-align: right;">466</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Peralta, Freddy</td>
<td style="text-align: right;">2430</td>
<td style="text-align: right;">1253</td>
<td style="text-align: right;">1177</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rea, Colin</td>
<td style="text-align: right;">1651</td>
<td style="text-align: right;">1334</td>
<td style="text-align: right;">317</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Woodruff, Brandon</td>
<td style="text-align: right;">882</td>
<td style="text-align: right;">554</td>
<td style="text-align: right;">328</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
</section>
<section id="imputing-incomplete-pitch-data" class="level2">
<h2 class="anchored" data-anchor-id="imputing-incomplete-pitch-data">Imputing Incomplete Pitch Data</h2>
<p>Multiple imputation will be performed using the chained equations or fully conditional specification with the <code>mice</code> R package <span class="citation" data-cites="buuren2010mice">(<a href="#ref-buuren2010mice" role="doc-biblioref">S. van Buuren and Groothuis-Oudshoorn 2010</a>)</span> with estimates pooled by the <code>broom.mixed</code> R package <span class="citation" data-cites="bolkerBroomMixed2022">(<a href="#ref-bolkerBroomMixed2022" role="doc-biblioref">Bolker and Robinson 2022</a>)</span>. The inline data will be imputed by <code>method = "pmm"</code> which uses predictive mean matching. The angular data, spin rate, will be imputed by <code>method = "pnregid"</code> which uses Bayesian projected normal regression with a constrained covariance matrix <span class="math inline">\(\Sigma\)</span> <span class="citation" data-cites="hernandez-stumpfhauser2017">(<a href="#ref-hernandez-stumpfhauser2017" role="doc-biblioref">Hernandez-Stumpfhauser, Breidt, and Woerd 2017</a>)</span> from my <code>imputeangles</code> package.</p>
<p>To impute with the projected normal regression, we have to specify to <code>mice</code> which variable is angular and which variables are the <span class="math inline">\(\cos\)</span> and <span class="math inline">\(\sin\)</span> of the angular variable. We can do this by doing an empty run of <code>mice()</code> by setting the maximum number of cycles to 0. Then we extract the methods vector and predictor matrix to modify and then pass to our actual run of <code>mice()</code> with <span class="math inline">\(M = 5\)</span> imputations and <span class="math inline">\(c = 10\)</span> cycles.</p>
<div class="cell" data-hash="index_cache/html/set-up-mice_ca2bcfa006de2b6a89b45be092f6fe1b">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pitches[,<span class="fu">c</span>(<span class="st">"release_speed"</span>, <span class="st">"release_extension"</span>, <span class="st">"release_spin_rate"</span>)] <span class="ot">&lt;-</span> <span class="fu">scale</span>(pitches[,<span class="fu">c</span>(<span class="st">"release_speed"</span>, <span class="st">"release_extension"</span>, <span class="st">"release_spin_rate"</span>)])</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pitches <span class="ot">&lt;-</span> pitches <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">rate_cos_spin =</span> release_spin_rate <span class="sc">*</span> <span class="fu">cos</span>(spin_axis),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">rate_sin_spin =</span> release_spin_rate <span class="sc">*</span> <span class="fu">sin</span>(spin_axis)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>imp0 <span class="ot">&lt;-</span> <span class="fu">mice</span>(pitches, <span class="at">m =</span> <span class="dv">1</span>, <span class="at">maxit =</span> <span class="dv">0</span>, <span class="at">method =</span> <span class="st">"pmm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Number of logged events: 6</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>methods <span class="ot">&lt;-</span> imp0<span class="sc">$</span>method</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"spin_axis"</span>] <span class="ot">&lt;-</span> <span class="st">"bpnreg"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"cos_spin"</span>] <span class="ot">&lt;-</span> <span class="st">"~cos(spin_axis)"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"sin_spin"</span>] <span class="ot">&lt;-</span> <span class="st">"~sin(spin_axis)"</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"cos_2spin"</span>] <span class="ot">&lt;-</span> <span class="st">"~cos(2*spin_axis)"</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"sin_2spin"</span>] <span class="ot">&lt;-</span> <span class="st">"~sin(2*spin_axis)"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>methods</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          game_date             pitcher              batter           home_team 
                 ""                  ""                  ""                  "" 
          away_team          pitch_type                type       release_speed 
                 ""                  ""                  ""               "pmm" 
  release_spin_rate   release_extension           spin_axis       release_pos_x 
              "pmm"               "pmm"            "bpnreg"               "pmm" 
      release_pos_z             plate_x             plate_z         player_name 
              "pmm"               "pmm"               "pmm"                  "" 
             events         description            cos_spin            sin_spin 
                 ""                  ""   "~cos(spin_axis)"   "~sin(spin_axis)" 
          cos_2spin           sin_2spin       rate_cos_spin       rate_sin_spin 
"~cos(2*spin_axis)" "~sin(2*spin_axis)"               "pmm"               "pmm" </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pred_mat <span class="ot">&lt;-</span> imp0<span class="sc">$</span>predictorMatrix</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>pred_mat[,<span class="fu">c</span>(<span class="st">"game_date"</span>, <span class="st">"pitcher"</span>, <span class="st">"batter"</span>, <span class="st">"home_team"</span>, <span class="st">"away_team"</span>, <span class="st">"type"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"events"</span>, <span class="st">"player_name"</span>, <span class="st">"description"</span>, <span class="st">"spin_axis"</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>pred_mat[<span class="st">"spin_axis"</span>, <span class="fu">c</span>(<span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>, <span class="st">"cos_2spin"</span>, <span class="st">"sin_2spin"</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>pred_mat[<span class="fu">c</span>(<span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>, <span class="st">"cos_2spin"</span>, <span class="st">"sin_2spin"</span>), ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>pred_mat[<span class="fu">c</span>(<span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>, <span class="st">"cos_2spin"</span>, <span class="st">"sin_2spin"</span>), <span class="st">"spin_axis"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>pred_mat[<span class="fu">c</span>(<span class="st">"spin_axis"</span>, <span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>), <span class="fu">c</span>(<span class="st">"spin_axis"</span>, <span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>, <span class="st">"release_speed"</span>, <span class="st">"release_extension"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          spin_axis cos_spin sin_spin release_speed release_extension
spin_axis         0        0        0             1                 1
cos_spin          1        0        0             0                 0
sin_spin          1        0        0             0                 0</code></pre>
</div>
</div>
<p>After setting up the methods vector and predictor matrix, we can run <code>mice()</code>.</p>
<div class="cell" data-hash="index_cache/html/run-mice-norun_e224cebb058cf84205fa44a43b303879">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>imps <span class="ot">&lt;-</span> <span class="fu">mice</span>(pitches, <span class="at">m =</span> <span class="dv">5</span>, <span class="at">maxit =</span> <span class="dv">5</span>, <span class="at">method =</span> methods,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">predictorMatrix =</span> pred_mat, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="logistic-regression-glmm-with-lme4" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-glmm-with-lme4">Logistic Regression GLMM with lme4</h2>
<p>The logistic regression mixed effects model is then fit to each of the completed data sets. Estimates and their variances are combined with <code>broom.mixed</code>.</p>
<div class="cell" data-hash="index_cache/html/fit-glmm-imps-norun_2b39a50566de727b0c4ef1a5d3ab4b91">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imps, lme4<span class="sc">::</span><span class="fu">glmer</span>(strike <span class="sc">~</span> cos_spin <span class="sc">+</span> sin_spin <span class="sc">+</span> cos_2spin <span class="sc">+</span> sin_2spin </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> release_speed <span class="sc">+</span> release_extension </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> plate_x <span class="sc">*</span> plate_z <span class="sc">+</span> release_pos_x <span class="sc">*</span> release_pos_z</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> pitch_type <span class="sc">|</span> player_name),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>pooled <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pooled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/tbl-glmm-pooled_e23eaeb087f294af42cef2293433ba05">
<div id="tbl-glmm-pooled" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-hash="index_cache/html/tbl-glmm-pooled_e23eaeb087f294af42cef2293433ba05">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-glmm-pooled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Pooled summary of the fits for the GLMM.
</figcaption>
<div aria-describedby="tbl-glmm-pooled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 35%">
<col style="width: 17%">
<col style="width: 22%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Term</th>
<th style="text-align: right;"><span class="math inline">\(\hat{\beta}\)</span></th>
<th style="text-align: right;"><span class="math inline">\(se(\hat{\beta})\)</span></th>
<th style="text-align: right;">LB 95% CI</th>
<th style="text-align: right;">UB 95% CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-1.8988</td>
<td style="text-align: right;">1.7676</td>
<td style="text-align: right;">-5.3654</td>
<td style="text-align: right;">1.5678</td>
</tr>
<tr class="even">
<td style="text-align: left;">cos_spin</td>
<td style="text-align: right;">0.0643</td>
<td style="text-align: right;">0.3563</td>
<td style="text-align: right;">-0.6341</td>
<td style="text-align: right;">0.7628</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sin_spin</td>
<td style="text-align: right;">0.2623</td>
<td style="text-align: right;">1.4698</td>
<td style="text-align: right;">-2.6239</td>
<td style="text-align: right;">3.1485</td>
</tr>
<tr class="even">
<td style="text-align: left;">cos_2spin</td>
<td style="text-align: right;">-0.0039</td>
<td style="text-align: right;">0.4929</td>
<td style="text-align: right;">-0.9718</td>
<td style="text-align: right;">0.9640</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sin_2spin</td>
<td style="text-align: right;">0.1724</td>
<td style="text-align: right;">0.2551</td>
<td style="text-align: right;">-0.3276</td>
<td style="text-align: right;">0.6725</td>
</tr>
<tr class="even">
<td style="text-align: left;">release_speed</td>
<td style="text-align: right;">-0.0314</td>
<td style="text-align: right;">0.0561</td>
<td style="text-align: right;">-0.1414</td>
<td style="text-align: right;">0.0786</td>
</tr>
<tr class="odd">
<td style="text-align: left;">release_extension</td>
<td style="text-align: right;">0.0012</td>
<td style="text-align: right;">0.0341</td>
<td style="text-align: right;">-0.0656</td>
<td style="text-align: right;">0.0681</td>
</tr>
<tr class="even">
<td style="text-align: left;">rate_cos_spin</td>
<td style="text-align: right;">-0.1007</td>
<td style="text-align: right;">0.0840</td>
<td style="text-align: right;">-0.2654</td>
<td style="text-align: right;">0.0640</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rate_sin_spin</td>
<td style="text-align: right;">0.1008</td>
<td style="text-align: right;">0.0446</td>
<td style="text-align: right;">0.0134</td>
<td style="text-align: right;">0.1882</td>
</tr>
<tr class="even">
<td style="text-align: left;">plate_x</td>
<td style="text-align: right;">-1.1104</td>
<td style="text-align: right;">0.0659</td>
<td style="text-align: right;">-1.2396</td>
<td style="text-align: right;">-0.9811</td>
</tr>
<tr class="odd">
<td style="text-align: left;">plate_z</td>
<td style="text-align: right;">0.4396</td>
<td style="text-align: right;">0.0272</td>
<td style="text-align: right;">0.3863</td>
<td style="text-align: right;">0.4929</td>
</tr>
<tr class="even">
<td style="text-align: left;">release_pos_x</td>
<td style="text-align: right;">-0.6002</td>
<td style="text-align: right;">0.4430</td>
<td style="text-align: right;">-1.4689</td>
<td style="text-align: right;">0.2684</td>
</tr>
<tr class="odd">
<td style="text-align: left;">release_pos_z</td>
<td style="text-align: right;">0.1745</td>
<td style="text-align: right;">0.2194</td>
<td style="text-align: right;">-0.2555</td>
<td style="text-align: right;">0.6046</td>
</tr>
<tr class="even">
<td style="text-align: left;">plate_x:plate_z</td>
<td style="text-align: right;">0.5631</td>
<td style="text-align: right;">0.0291</td>
<td style="text-align: right;">0.5061</td>
<td style="text-align: right;">0.6201</td>
</tr>
<tr class="odd">
<td style="text-align: left;">release_pos_x:release_pos_z</td>
<td style="text-align: right;">0.0806</td>
<td style="text-align: right;">0.0717</td>
<td style="text-align: right;">-0.0600</td>
<td style="text-align: right;">0.2212</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>We can take a look at the effects of the spin axis on the probability that a pitch will be a strike for each pitcher and their pitch types.</p>
<div class="cell" data-hash="index_cache/html/get-avg-pitch-vals_0a952eb88974c5af3bc1d1a71853f32d">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>avg_pitches <span class="ot">&lt;-</span> pitches <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(player_name, pitch_type) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_spin =</span> <span class="fu">mean</span>(cos_spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_spin =</span> <span class="fu">mean</span>(sin_spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_2spin =</span> <span class="fu">mean</span>(cos_2spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_2spin =</span> <span class="fu">mean</span>(sin_2spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">release_speed =</span> <span class="fu">mean</span>(release_speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">release_extension =</span> <span class="fu">mean</span>(release_extension, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">rate_cos_spin =</span> <span class="fu">mean</span>(release_spin_rate <span class="sc">*</span> cos_spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">rate_sin_spin =</span> <span class="fu">mean</span>(release_spin_rate <span class="sc">*</span> sin_spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plate_x =</span> <span class="fu">mean</span>(plate_x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">plate_z =</span> <span class="fu">mean</span>(plate_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">release_pos_x =</span> <span class="fu">mean</span>(release_pos_x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">release_pos_z =</span> <span class="fu">mean</span>(release_pos_x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"release_pos_x:release_pos_z"</span> <span class="ot">=</span> <span class="fu">mean</span>(release_pos_x <span class="sc">*</span> release_pos_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'player_name'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/glmm-fe_06a39d1e2d5c7ba8cac2647de54f0b06">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fe <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit<span class="sc">$</span>analyses[[<span class="dv">1</span>]])<span class="sc">$</span>player_name</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>fe<span class="sc">$</span>player_name <span class="ot">&lt;-</span> <span class="fu">row.names</span>(fe)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>fe <span class="ot">&lt;-</span> fe <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"pitch_type"</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"pitch_type"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"re"</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/prob-strike-glmm-est_9331daa7c56aa0740bcbb2c3649dc567">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>p_strike <span class="ot">&lt;-</span> avg_pitches <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">pitch_type =</span> <span class="fu">paste0</span>(<span class="st">"pitch_type"</span>, pitch_type)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(fe, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"player_name"</span>, <span class="st">"pitch_type"</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_avg"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fe =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span> <span class="sc">+</span> cos_spin <span class="sc">*</span> cos_spin_avg <span class="sc">+</span> sin_spin <span class="sc">*</span> sin_spin_avg </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> cos_2spin <span class="sc">*</span> cos_2spin_avg <span class="sc">+</span> sin_2spin <span class="sc">*</span> sin_2spin_avg </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> release_speed <span class="sc">*</span> release_speed_avg <span class="sc">+</span> release_extension <span class="sc">*</span> release_extension_avg </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> rate_cos_spin <span class="sc">*</span> rate_cos_spin_avg <span class="sc">+</span> rate_sin_spin <span class="sc">*</span> rate_sin_spin_avg</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> plate_x <span class="sc">*</span> plate_x_avg <span class="sc">+</span> plate_z <span class="sc">*</span> plate_z_avg</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> release_pos_x <span class="sc">*</span> release_pos_x_avg </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> release_pos_z <span class="sc">*</span> release_pos_z_avg</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> <span class="st">`</span><span class="at">release_pos_x:release_pos_z</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">release_pos_x:release_pos_z_avg</span><span class="st">`</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">logit =</span> fe <span class="sc">+</span> re,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">p_strike =</span> <span class="fu">plogis</span>(logit)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        player_name, pitch_type, logit, p_strike</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/fig-est-p-strike-glmm_41a443b9429c8f645eaa703b27952e63">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_strike, <span class="fu">aes</span>(player_name, p_strike, <span class="at">color =</span> pitch_type)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">25</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"P(Strike)"</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-est-p-strike-glmm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-est-p-strike-glmm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-est-p-strike-glmm-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-est-p-strike-glmm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Estimated probability that each pitcher’s pitch types will be a strike on average.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-est-p-strike-glmm" class="quarto-xref">Figure&nbsp;2</a>, the probability that each pitch type thrown by each pitcher will be a strike. We can see that Burnes and Miley are very unlikely to throw strikes. This makes sense for Miley since he tries to get weak contact (very effectively with a the lowest hard hit rate in MLB for SP at 31.1%, but a less stellar FIP of 4.69). In Burnes case, this may be a result of his pitches having a lot of movement resulting in more balls, and worked relatively well (FIP of 3.81 on the year, but 3.07 BB/9). Freddy Peralta and Colin Rea live in the zone with all or most of their pitch types being thrown for strikes on average. This worked well for Freddy in 2023, particularly in the second half of 2023 when he had a FIP of 2.92 (9th out of starters), and less well for Rea who had a FIP of 4.90 on the year. Woodruff and Houser were balanced in their approach.</p>
<table class="caption-top table">
<caption>2023 Results</caption>
<thead>
<tr class="header">
<th>Name</th>
<th>K/9</th>
<th>BB/9</th>
<th>FIP</th>
<th>HardHit%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Corbin Burnes</td>
<td>9.29</td>
<td>3.07</td>
<td>3.81</td>
<td>32.2%</td>
</tr>
<tr class="even">
<td>Adrian Houser</td>
<td>7.76</td>
<td>2.75</td>
<td>3.99</td>
<td>46.4%</td>
</tr>
<tr class="odd">
<td>Wade Miley</td>
<td>5.91</td>
<td>2.84</td>
<td>4.69</td>
<td>31.1%</td>
</tr>
<tr class="even">
<td>Freddy Peralta</td>
<td>11.41</td>
<td>2.93</td>
<td>3.85</td>
<td>37.3%</td>
</tr>
<tr class="odd">
<td>Colin Rea</td>
<td>7.94</td>
<td>2.74</td>
<td>4.90</td>
<td>43.2%</td>
</tr>
<tr class="even">
<td>Brandon Woodruff</td>
<td>9.94</td>
<td>2.01</td>
<td>3.60</td>
<td>41.6%</td>
</tr>
</tbody>
</table>
<!-- ### Modeling with brms -->


<!-- -->


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bolkerBroomMixed2022" class="csl-entry" role="listitem">
Bolker, Ben, and David Robinson. 2022. <em>Broom.mixed: Tidying Methods for Mixed Models</em>. <a href="https://CRAN.R-project.org/package=broom.mixed">https://CRAN.R-project.org/package=broom.mixed</a>.
</div>
<div id="ref-buuren2010mice" class="csl-entry" role="listitem">
Buuren, S van, and Karin Groothuis-Oudshoorn. 2010. <span>“Mice: Multivariate Imputation by Chained Equations in r.”</span> <em>Journal of Statistical Software</em>, 168.
</div>
<div id="ref-buuren2018" class="csl-entry" role="listitem">
Buuren, Stef van. 2018. <em>Flexible Imputation of Missing Data</em>. 2nd ed. Interdisciplinary Statistics Series. Chapman; Hall/CRC. <a href="https://stefvanbuuren.name/fimd/">https://stefvanbuuren.name/fimd/</a>.
</div>
<div id="ref-harel2003strategies" class="csl-entry" role="listitem">
Harel, Ofer. 2009. <em>Strategies for Data Analysis with Two Types of Missing Values</em>. Lap Lambert Academic Publishing GmbH KG.
</div>
<div id="ref-hernandez-stumpfhauser2017" class="csl-entry" role="listitem">
Hernandez-Stumpfhauser, Daniel, F. Jay Breidt, and Mark J. van der Woerd. 2017. <span>“The General Projected Normal Distribution of Arbitrary Dimension: Modeling and Bayesian Inference.”</span> <em>Bayesian Analysis</em> 12 (1): 113–33. <a href="https://doi.org/10.1214/15-BA989">https://doi.org/10.1214/15-BA989</a>.
</div>
<div id="ref-li2006analysis" class="csl-entry" role="listitem">
Li, Xiaoming, Devan V Mehrotra, and John Barnard. 2006. <span>“Analysis of Incomplete Longitudinal Binary Data Using Multiple Imputation.”</span> <em>Statistics in Medicine</em> 25 (12): 21072124.
</div>
<div id="ref-moritz2022" class="csl-entry" role="listitem">
Moritz, Steffen, Sebastian Gatscha, Earo Wang, and Ron Hause. 2022. <em>imputeTS: Time Series Missing Value Imputation</em>. <a href="https://CRAN.R-project.org/package=imputeTS">https://CRAN.R-project.org/package=imputeTS</a>.
</div>
<div id="ref-rubin1978" class="csl-entry" role="listitem">
Rubin, Donald B. 1978. <span>“Multiple Imputation in Sample Surveys - A Phenomenological Bayesian Approach to Nonresponse.”</span> <em>Proceedings of the Survey Research Methods Section of Hte American Statistical Association</em> 1: 9.
</div>
<div id="ref-rubin1987" class="csl-entry" role="listitem">
———. 1987. <em>Multiple Imputation for Nonresponse in Surveys | Wiley Series in Probability and Statistics</em>. Wiley series in probability and mathematical statistics : Applied probability and statistics. New York: Wiley. <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/9780470316696">https://onlinelibrary.wiley.com/doi/book/10.1002/9780470316696</a>.
</div>
<div id="ref-schafer1999multiple" class="csl-entry" role="listitem">
Schafer, Joseph L. 1999. <span>“Multiple Imputation: A Primer.”</span> <em>Statistical Methods in Medical Research</em> 8 (1): 315.
</div>
<div id="ref-schafer2002" class="csl-entry" role="listitem">
Schafer, Joseph L., and John W. Graham. 2002. <span>“Missing Data: Our View of the State of the Art.”</span> <em>Psychological Methods</em> 7 (2): 147–77. <a href="https://doi.org/10.1037/1082-989X.7.2.147">https://doi.org/10.1037/1082-989X.7.2.147</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Without making modifications to the core MI procedure, we have to assume normality for <span class="math inline">\(\hat{Q}\)</span>, ignorability (missing at random and independent priors for the missingness mechanism and data model), and that all assumptions for the imputation procedure are satisfied.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>See Driveline Baseball and Tread Athletics as well as the numerous pitching labs run by Major League teams.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/benjamin-stockton\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb18" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "How to Use imputeangles"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Ben Stockton"</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2024-02-21</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">    html:</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">        code-fold: show</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">        code-tools: true</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">        number-depth: 3</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">        toc: true</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">        toc-location: left</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">        toc-expand: 2</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">        toc-depth: 3</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">        link-external-newwindow: true</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">        citations-hover: true</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="an">cache:</span><span class="co"> true</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>In this post, I will provide a brief introduction to using multiple imputation (MI) and then share an example analysis of pitch movement using my <span class="in">`imputeangles`</span> package.</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>Most statistical analysis methods are designed with complete data in mind, however, real-world data is often incomplete with observations missing due to nonresponse, censoring, or measurement issues. The incomplete data cannot be directly analyzed with the complete data statistical methods. While there are specialized methods designed to model incomplete data, due to the convenience and wide availability of complete data methods it would be highly beneficial to complete the incomplete data. This could be accomplished by removing incomplete cases and performing complete case analysis (CCA), but this could throw out lots of useful data <span class="co">[</span><span class="ot">@schafer2002</span><span class="co">]</span>.</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multiple Imputation</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>Imputation is the process of replacing the missing values with values deterministically calculated by the observed data or with values drawn from a probability distribution shaped by the observed data. Two common, but not theoretically valid, ways to do this are mean imputation (replace with the sample mean or regression predicted values) <span class="co">[</span><span class="ot">@schafer1999multiple</span><span class="co">]</span> or last observation carried forward (LOCF) for time series or longitudinal data <span class="co">[</span><span class="ot">@moritz2022</span><span class="co">]</span>. These methods are performed a single time to create a singly imputed (SI) data set. Alternatively, we could impute the missing values with random draws from the observed data or from a predictive distribution based on the observed data. These imputations are worse in terms of providing accurate predictions for the missing value, however, they do reflect the uncertainty of the missing value. Repeatedly imputing the missing values to create multiple imputed data sets can propagate the uncertainty to the analysis.</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>This process is called by Multiple Imputation (MI) and was initially developed by Donald Rubin in the 1970s and 1980s for nonresponse in surveys <span class="co">[</span><span class="ot">@rubin1978, @rubin1987</span><span class="co">]</span>, and then extended to more analysis contexts since the 1990s <span class="co">[</span><span class="ot">@li2006analysis, @harel2003strategies</span><span class="co">]</span>. The foundation of MI is a three stage process.</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Impute - Fill in the missing values with random samples from a predictive distribution (posterior predictive draws theoretically preferred) to create $M$ completed data sets.</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Analyze - Analyze each of the $M$ data sets with a complete data method to estimate a quantity of interest $Q$ using estimate $\hat{Q}_m$ and its squared standard error $U_m = SE(\hat{Q})^2$.</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Combine - Use Rubin's Rules to combine the estimates and variances to perform inference on the quantity of interest $Q$.</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    <span class="in">```{=tex}</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="in">    \begin{align*} \label{eq-rubins-rules}</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="in">        \bar{Q} &amp;= \frac{1}{M} \sum_{m=1}^M \hat{Q}_m \\</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="in">        \bar{U} &amp;= \frac{1}{M} \sum_{m=1}^M U_m \\</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="in">        B &amp;= \frac{1}{M-1} \sum_{m=1}^M (\hat{Q}_m - \bar{Q})^2 \\</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="in">        T &amp;= \bar{U} + (1 + \frac{1}{M}) B</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="in">    \end{align*}</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="in">    ```</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>Under a set of assumptions<span class="ot">[^1]</span>, the inferences produced by MI will be unbiased, more efficient than CCA, and confidence valid. Rubin's rules have been developed for sample means, sample mean differences, regression coefficients, correlation coefficients, and more <span class="co">[</span><span class="ot">@buuren2018 Sec. 5.2</span><span class="co">]</span>.</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>Without making modifications to the core MI procedure, we have to assume normality for $\hat{Q}$, ignorability (missing at random and independent priors for the missingness mechanism and data model), and that all assumptions for the imputation procedure are satisfied.</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pitch Movement</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>In baseball, highly-skilled pitchers are able to impart different rates and axis of spin on the pitched ball resulting in varying movements (or lack thereof) on the pitch as it travels to the catcher. Modeling these characteristics has been a central development to coaching pitchers in the past decade<span class="ot">[^2]</span>. In the following illustrative analysis, we'll use pitch-level data collected by MLB to predict whether a non-batted pitch will be swung at and missed.</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>See Driveline Baseball and Tread Athletics as well as the numerous pitching labs run by Major League teams.</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Loading Pitch Data</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-pitch-data-no-run</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Amelia)</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(imputeangles)</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>peralta_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Peralta"</span>,</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">first_name =</span> <span class="st">"Freddy"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>burnes_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Burnes"</span>, </span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">first_name =</span> <span class="st">"Corbin"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>miley_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Miley"</span>, </span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">first_name =</span> <span class="st">"Wade"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>rea_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Rea"</span>, </span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">first_name =</span> <span class="st">"Colin"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>teheran_id <span class="ot">&lt;-</span> <span class="dv">527054</span></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>houser_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Houser"</span>, </span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">first_name =</span> <span class="st">"Adrian"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>woodruff_id <span class="ot">&lt;-</span> baseballr<span class="sc">::</span><span class="fu">playerid_lookup</span>(<span class="at">last_name =</span> <span class="st">"Woodruff"</span>, </span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">first_name =</span> <span class="st">"Brandon"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(mlbam_id)</span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>ids_list <span class="ot">&lt;-</span> <span class="fu">list</span>(peralta_id, burnes_id, rea_id, houser_id, </span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>                 miley_id, teheran_id, woodruff_id)</span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a><span class="co"># pitches &lt;- readr::read_csv()</span></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>pitches <span class="ot">&lt;-</span> <span class="fu">lapply</span>(ids_list, <span class="cf">function</span>(id) {</span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>    baseballr<span class="sc">::</span><span class="fu">statcast_search</span>(<span class="at">start_date =</span> <span class="st">"2023-03-01"</span>,</span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>                               <span class="at">end_dat =</span> <span class="st">"2023-10-31"</span>,</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>                               <span class="at">player_type =</span> <span class="st">"pitcher"</span>, <span class="at">playerid =</span> id)</span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>        game_date, pitcher, batter, game_type, home_team, away_team, </span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>       pitch_type, type, release_speed, release_spin_rate, release_extension,</span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>       spin_axis, release_pos_x, release_pos_z, plate_x, plate_z,</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>       player_name, events, description, launch_angle, launch_speed</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>        game_type <span class="sc">==</span> <span class="st">"R"</span>, </span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>        type <span class="sc">!=</span> <span class="st">"X"</span></span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>        <span class="at">spin_axis =</span> spin_axis <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">360</span>,</span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_spin =</span> <span class="fu">cos</span>(spin_axis),</span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_spin =</span> <span class="fu">sin</span>(spin_axis),</span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_2spin =</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>spin_axis),</span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_2spin =</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>spin_axis),</span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>        <span class="at">strike =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a>            type <span class="sc">==</span> <span class="st">"S"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>            type <span class="sc">==</span> <span class="st">"B"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>game_type)</span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(pitches, <span class="st">"data/brewers_sp_2023_pitches.csv"</span>)</span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-pitch-data</span></span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Amelia)</span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(imputeangles)</span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a>pitches <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/brewers_sp_2023_pitches.csv"</span>)</span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>pitches <span class="ot">&lt;-</span> pitches <span class="sc">|&gt;</span></span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>        game_date, pitcher, batter, game_type, home_team, away_team, </span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>       pitch_type, type, release_speed, release_spin_rate, release_extension,</span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a>       spin_axis, release_pos_x, release_pos_z, plate_x, plate_z,</span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a>       player_name, events, description</span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">|&gt;</span></span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(game_type <span class="sc">==</span> <span class="st">"R"</span>, </span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>           type <span class="sc">!=</span> <span class="st">"X"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>        <span class="at">spin_axis =</span> spin_axis <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">360</span>,</span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_spin =</span> <span class="fu">cos</span>(spin_axis),</span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_spin =</span> <span class="fu">sin</span>(spin_axis),</span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_2spin =</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>spin_axis),</span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_2spin =</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>spin_axis),</span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>        <span class="at">strike =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a>            type <span class="sc">==</span> <span class="st">"S"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a>            type <span class="sc">==</span> <span class="st">"B"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>game_type)</span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-miss-map</span></span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Missinginess matrix plot where red indicates missingness in that observation.</span></span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a>pitches <span class="sc">|&gt;</span></span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb18-183"><a href="#cb18-183" aria-hidden="true" tabindex="-1"></a>        pitch_type, release_speed, release_spin_rate, spin_axis,</span>
<span id="cb18-184"><a href="#cb18-184" aria-hidden="true" tabindex="-1"></a>        release_extension, plate_x, plate_z  </span>
<span id="cb18-185"><a href="#cb18-185" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-186"><a href="#cb18-186" aria-hidden="true" tabindex="-1"></a>    VIM<span class="sc">::</span><span class="fu">matrixplot</span>()</span>
<span id="cb18-187"><a href="#cb18-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-188"><a href="#cb18-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-189"><a href="#cb18-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-190"><a href="#cb18-190" aria-hidden="true" tabindex="-1"></a>We'll take a look at an example of how to perform MI in practice in comparison to CCA. We have a data set of $N =$ <span class="in">`r nrow(pitches)`</span> caught pitches (swing and called strikes, balls, or hit by pitches) pitches from the 2023 MLB season with measurements for the pitch outcome, pitch velocity and spin direction and rate at release, release point, horizontal and vertical break, location at the plate, as well as the identity of the batter, pitcher, and ballpark. We will model the pitch outcome based on the other measurements while using random effects for the batter, pitcher, and ballpark. In this analysis our quantity of interest is the effect of spin rate $\beta_{SpinRate}$ on the pitch outcome given the pitch was not fouled off or put in play which will be estimated using a mixed effects logistic regression model.</span>
<span id="cb18-191"><a href="#cb18-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-194"><a href="#cb18-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-195"><a href="#cb18-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pitches-thrown-norun</span></span>
<span id="cb18-196"><a href="#cb18-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb18-197"><a href="#cb18-197" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb18-198"><a href="#cb18-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-199"><a href="#cb18-199" aria-hidden="true" tabindex="-1"></a>pitches <span class="sc">|&gt;</span></span>
<span id="cb18-200"><a href="#cb18-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(player_name) <span class="sc">|&gt;</span></span>
<span id="cb18-201"><a href="#cb18-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n_pitches =</span> <span class="fu">n</span>(),</span>
<span id="cb18-202"><a href="#cb18-202" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_fastball =</span> <span class="fu">sum</span>(pitch_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FC"</span>, <span class="st">"FF"</span>, <span class="st">"FS"</span>, <span class="st">"SI"</span>)),</span>
<span id="cb18-203"><a href="#cb18-203" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_offspeed =</span> <span class="fu">sum</span>(pitch_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CH"</span>, <span class="st">"CU"</span>, <span class="st">"SL"</span>, <span class="st">"ST"</span>)),</span>
<span id="cb18-204"><a href="#cb18-204" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_missing =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(pitch_type))) </span>
<span id="cb18-205"><a href="#cb18-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-206"><a href="#cb18-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-207"><a href="#cb18-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-210"><a href="#cb18-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-211"><a href="#cb18-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-pitches-thrown</span></span>
<span id="cb18-212"><a href="#cb18-212" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Number of pitches thrown by each starting pitcher.</span></span>
<span id="cb18-213"><a href="#cb18-213" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb18-214"><a href="#cb18-214" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb18-215"><a href="#cb18-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-216"><a href="#cb18-216" aria-hidden="true" tabindex="-1"></a>pitches<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(pitches<span class="sc">$</span>type)</span>
<span id="cb18-217"><a href="#cb18-217" aria-hidden="true" tabindex="-1"></a>pitches <span class="sc">|&gt;</span></span>
<span id="cb18-218"><a href="#cb18-218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(player_name) <span class="sc">|&gt;</span></span>
<span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n_pitches =</span> <span class="fu">n</span>(),</span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_fastball =</span> <span class="fu">sum</span>(pitch_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FC"</span>, <span class="st">"FF"</span>, <span class="st">"FS"</span>, <span class="st">"SI"</span>)),</span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_offspeed =</span> <span class="fu">sum</span>(pitch_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CH"</span>, <span class="st">"CU"</span>, <span class="st">"SL"</span>, <span class="st">"ST"</span>)),</span>
<span id="cb18-222"><a href="#cb18-222" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_missing =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(pitch_type))) <span class="sc">|&gt;</span></span>
<span id="cb18-223"><a href="#cb18-223" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb18-224"><a href="#cb18-224" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Name"</span>, <span class="st">"N Pitches"</span>, <span class="st">"N Fastball"</span>, <span class="st">"N Offspeed"</span>, <span class="st">"N Missing"</span>))</span>
<span id="cb18-225"><a href="#cb18-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-226"><a href="#cb18-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-227"><a href="#cb18-227" aria-hidden="true" tabindex="-1"></a><span class="fu">## Imputing Incomplete Pitch Data</span></span>
<span id="cb18-228"><a href="#cb18-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-229"><a href="#cb18-229" aria-hidden="true" tabindex="-1"></a>Multiple imputation will be performed using the chained equations or fully conditional specification with the <span class="in">`mice`</span> R package <span class="co">[</span><span class="ot">@buuren2010mice</span><span class="co">]</span> with estimates pooled by the <span class="in">`broom.mixed`</span> R package <span class="co">[</span><span class="ot">@bolkerBroomMixed2022</span><span class="co">]</span>. The inline data will be imputed by <span class="in">`method = "pmm"`</span> which uses predictive mean matching. The angular data, spin rate, will be imputed by <span class="in">`method = "pnregid"`</span> which uses Bayesian projected normal regression with a constrained covariance matrix $\Sigma$ <span class="co">[</span><span class="ot">@hernandez-stumpfhauser2017</span><span class="co">]</span> from my <span class="in">`imputeangles`</span> package.</span>
<span id="cb18-230"><a href="#cb18-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-231"><a href="#cb18-231" aria-hidden="true" tabindex="-1"></a>To impute with the projected normal regression, we have to specify to <span class="in">`mice`</span> which variable is angular and which variables are the $\cos$ and $\sin$ of the angular variable. We can do this by doing an empty run of <span class="in">`mice()`</span> by setting the maximum number of cycles to 0. Then we extract the methods vector and predictor matrix to modify and then pass to our actual run of <span class="in">`mice()`</span> with $M = 5$ imputations and $c = 10$ cycles.</span>
<span id="cb18-232"><a href="#cb18-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-235"><a href="#cb18-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-236"><a href="#cb18-236" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: set-up-mice</span></span>
<span id="cb18-237"><a href="#cb18-237" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb18-238"><a href="#cb18-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-239"><a href="#cb18-239" aria-hidden="true" tabindex="-1"></a>pitches[,<span class="fu">c</span>(<span class="st">"release_speed"</span>, <span class="st">"release_extension"</span>, <span class="st">"release_spin_rate"</span>)] <span class="ot">&lt;-</span> <span class="fu">scale</span>(pitches[,<span class="fu">c</span>(<span class="st">"release_speed"</span>, <span class="st">"release_extension"</span>, <span class="st">"release_spin_rate"</span>)])</span>
<span id="cb18-240"><a href="#cb18-240" aria-hidden="true" tabindex="-1"></a>pitches <span class="ot">&lt;-</span> pitches <span class="sc">|&gt;</span></span>
<span id="cb18-241"><a href="#cb18-241" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb18-242"><a href="#cb18-242" aria-hidden="true" tabindex="-1"></a>        <span class="at">rate_cos_spin =</span> release_spin_rate <span class="sc">*</span> <span class="fu">cos</span>(spin_axis),</span>
<span id="cb18-243"><a href="#cb18-243" aria-hidden="true" tabindex="-1"></a>        <span class="at">rate_sin_spin =</span> release_spin_rate <span class="sc">*</span> <span class="fu">sin</span>(spin_axis)</span>
<span id="cb18-244"><a href="#cb18-244" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-245"><a href="#cb18-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-246"><a href="#cb18-246" aria-hidden="true" tabindex="-1"></a>imp0 <span class="ot">&lt;-</span> <span class="fu">mice</span>(pitches, <span class="at">m =</span> <span class="dv">1</span>, <span class="at">maxit =</span> <span class="dv">0</span>, <span class="at">method =</span> <span class="st">"pmm"</span>)</span>
<span id="cb18-247"><a href="#cb18-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-248"><a href="#cb18-248" aria-hidden="true" tabindex="-1"></a>methods <span class="ot">&lt;-</span> imp0<span class="sc">$</span>method</span>
<span id="cb18-249"><a href="#cb18-249" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"spin_axis"</span>] <span class="ot">&lt;-</span> <span class="st">"bpnreg"</span></span>
<span id="cb18-250"><a href="#cb18-250" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"cos_spin"</span>] <span class="ot">&lt;-</span> <span class="st">"~cos(spin_axis)"</span></span>
<span id="cb18-251"><a href="#cb18-251" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"sin_spin"</span>] <span class="ot">&lt;-</span> <span class="st">"~sin(spin_axis)"</span></span>
<span id="cb18-252"><a href="#cb18-252" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"cos_2spin"</span>] <span class="ot">&lt;-</span> <span class="st">"~cos(2*spin_axis)"</span></span>
<span id="cb18-253"><a href="#cb18-253" aria-hidden="true" tabindex="-1"></a>methods[<span class="st">"sin_2spin"</span>] <span class="ot">&lt;-</span> <span class="st">"~sin(2*spin_axis)"</span></span>
<span id="cb18-254"><a href="#cb18-254" aria-hidden="true" tabindex="-1"></a>methods</span>
<span id="cb18-255"><a href="#cb18-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-256"><a href="#cb18-256" aria-hidden="true" tabindex="-1"></a>pred_mat <span class="ot">&lt;-</span> imp0<span class="sc">$</span>predictorMatrix</span>
<span id="cb18-257"><a href="#cb18-257" aria-hidden="true" tabindex="-1"></a>pred_mat[,<span class="fu">c</span>(<span class="st">"game_date"</span>, <span class="st">"pitcher"</span>, <span class="st">"batter"</span>, <span class="st">"home_team"</span>, <span class="st">"away_team"</span>, <span class="st">"type"</span>,</span>
<span id="cb18-258"><a href="#cb18-258" aria-hidden="true" tabindex="-1"></a>            <span class="st">"events"</span>, <span class="st">"player_name"</span>, <span class="st">"description"</span>, <span class="st">"spin_axis"</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-259"><a href="#cb18-259" aria-hidden="true" tabindex="-1"></a>pred_mat[<span class="st">"spin_axis"</span>, <span class="fu">c</span>(<span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>, <span class="st">"cos_2spin"</span>, <span class="st">"sin_2spin"</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-260"><a href="#cb18-260" aria-hidden="true" tabindex="-1"></a>pred_mat[<span class="fu">c</span>(<span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>, <span class="st">"cos_2spin"</span>, <span class="st">"sin_2spin"</span>), ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-261"><a href="#cb18-261" aria-hidden="true" tabindex="-1"></a>pred_mat[<span class="fu">c</span>(<span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>, <span class="st">"cos_2spin"</span>, <span class="st">"sin_2spin"</span>), <span class="st">"spin_axis"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-262"><a href="#cb18-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-263"><a href="#cb18-263" aria-hidden="true" tabindex="-1"></a>pred_mat[<span class="fu">c</span>(<span class="st">"spin_axis"</span>, <span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>), <span class="fu">c</span>(<span class="st">"spin_axis"</span>, <span class="st">"cos_spin"</span>, <span class="st">"sin_spin"</span>, <span class="st">"release_speed"</span>, <span class="st">"release_extension"</span>)]</span>
<span id="cb18-264"><a href="#cb18-264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-265"><a href="#cb18-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-266"><a href="#cb18-266" aria-hidden="true" tabindex="-1"></a>After setting up the methods vector and predictor matrix, we can run <span class="in">`mice()`</span>.</span>
<span id="cb18-267"><a href="#cb18-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-270"><a href="#cb18-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-271"><a href="#cb18-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run-mice-norun</span></span>
<span id="cb18-272"><a href="#cb18-272" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb18-273"><a href="#cb18-273" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb18-274"><a href="#cb18-274" aria-hidden="true" tabindex="-1"></a>imps <span class="ot">&lt;-</span> <span class="fu">mice</span>(pitches, <span class="at">m =</span> <span class="dv">5</span>, <span class="at">maxit =</span> <span class="dv">5</span>, <span class="at">method =</span> methods,</span>
<span id="cb18-275"><a href="#cb18-275" aria-hidden="true" tabindex="-1"></a>             <span class="at">predictorMatrix =</span> pred_mat, <span class="at">printFlag =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-276"><a href="#cb18-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-277"><a href="#cb18-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-280"><a href="#cb18-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-281"><a href="#cb18-281" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: run-mice</span></span>
<span id="cb18-282"><a href="#cb18-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb18-283"><a href="#cb18-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb18-284"><a href="#cb18-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-285"><a href="#cb18-285" aria-hidden="true" tabindex="-1"></a>imps <span class="ot">&lt;-</span> <span class="fu">mice</span>(pitches, <span class="at">m =</span> <span class="dv">5</span>, <span class="at">maxit =</span> <span class="dv">5</span>, <span class="at">method =</span> methods,</span>
<span id="cb18-286"><a href="#cb18-286" aria-hidden="true" tabindex="-1"></a>             <span class="at">predictorMatrix =</span> pred_mat, <span class="at">printFlag =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-287"><a href="#cb18-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-288"><a href="#cb18-288" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(imps, <span class="st">"data/pitch_imputations.rds"</span>)</span>
<span id="cb18-289"><a href="#cb18-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-290"><a href="#cb18-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-291"><a href="#cb18-291" aria-hidden="true" tabindex="-1"></a><span class="fu">## Logistic Regression GLMM with lme4</span></span>
<span id="cb18-292"><a href="#cb18-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-293"><a href="#cb18-293" aria-hidden="true" tabindex="-1"></a>The logistic regression mixed effects model is then fit to each of the completed data sets. Estimates and their variances are combined with <span class="in">`broom.mixed`</span>.</span>
<span id="cb18-294"><a href="#cb18-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-297"><a href="#cb18-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-298"><a href="#cb18-298" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fit-glmm-imps-norun</span></span>
<span id="cb18-299"><a href="#cb18-299" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb18-300"><a href="#cb18-300" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb18-301"><a href="#cb18-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-302"><a href="#cb18-302" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imps, lme4<span class="sc">::</span><span class="fu">glmer</span>(strike <span class="sc">~</span> cos_spin <span class="sc">+</span> sin_spin <span class="sc">+</span> cos_2spin <span class="sc">+</span> sin_2spin </span>
<span id="cb18-303"><a href="#cb18-303" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> release_speed <span class="sc">+</span> release_extension </span>
<span id="cb18-304"><a href="#cb18-304" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> plate_x <span class="sc">*</span> plate_z <span class="sc">+</span> release_pos_x <span class="sc">*</span> release_pos_z</span>
<span id="cb18-305"><a href="#cb18-305" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> pitch_type <span class="sc">|</span> player_name),</span>
<span id="cb18-306"><a href="#cb18-306" aria-hidden="true" tabindex="-1"></a>                              <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)))</span>
<span id="cb18-307"><a href="#cb18-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-308"><a href="#cb18-308" aria-hidden="true" tabindex="-1"></a>pooled <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit)</span>
<span id="cb18-309"><a href="#cb18-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-310"><a href="#cb18-310" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pooled)</span>
<span id="cb18-311"><a href="#cb18-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-312"><a href="#cb18-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-315"><a href="#cb18-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-316"><a href="#cb18-316" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fit-glmm-imps</span></span>
<span id="cb18-317"><a href="#cb18-317" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb18-318"><a href="#cb18-318" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb18-319"><a href="#cb18-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-320"><a href="#cb18-320" aria-hidden="true" tabindex="-1"></a>imps <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/pitch_imputations.rds"</span>)</span>
<span id="cb18-321"><a href="#cb18-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-322"><a href="#cb18-322" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imps, lme4<span class="sc">::</span><span class="fu">glmer</span>(strike <span class="sc">~</span> cos_spin <span class="sc">*</span> pitch_type <span class="sc">+</span> sin_spin <span class="sc">*</span> pitch_type </span>
<span id="cb18-323"><a href="#cb18-323" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> cos_2spin <span class="sc">*</span> pitch_type <span class="sc">+</span> sin_2spin <span class="sc">*</span> pitch_type  </span>
<span id="cb18-324"><a href="#cb18-324" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> release_speed <span class="sc">+</span> release_extension </span>
<span id="cb18-325"><a href="#cb18-325" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> rate_cos_spin <span class="sc">+</span> rate_sin_spin</span>
<span id="cb18-326"><a href="#cb18-326" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> plate_x <span class="sc">*</span> plate_z <span class="sc">+</span> plate_x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> plate_z<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb18-327"><a href="#cb18-327" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> release_pos_x <span class="sc">*</span> release_pos_z</span>
<span id="cb18-328"><a href="#cb18-328" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> release_pos_x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> release_pos_z<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb18-329"><a href="#cb18-329" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> pitch_type <span class="sc">|</span> player_name),</span>
<span id="cb18-330"><a href="#cb18-330" aria-hidden="true" tabindex="-1"></a>                              <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)))</span>
<span id="cb18-331"><a href="#cb18-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-332"><a href="#cb18-332" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit, <span class="st">"data/fit-glmm-imps.rds"</span>)</span>
<span id="cb18-333"><a href="#cb18-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-334"><a href="#cb18-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-337"><a href="#cb18-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-338"><a href="#cb18-338" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-glmm-pooled</span></span>
<span id="cb18-339"><a href="#cb18-339" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Pooled summary of the fits for the GLMM.</span></span>
<span id="cb18-340"><a href="#cb18-340" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb18-341"><a href="#cb18-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-342"><a href="#cb18-342" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/fit-glmm-imps.rds"</span>)</span>
<span id="cb18-343"><a href="#cb18-343" aria-hidden="true" tabindex="-1"></a>pooled <span class="ot">&lt;-</span> <span class="fu">pool</span>(fit)</span>
<span id="cb18-344"><a href="#cb18-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-345"><a href="#cb18-345" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pooled) <span class="sc">|&gt;</span> </span>
<span id="cb18-346"><a href="#cb18-346" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb18-347"><a href="#cb18-347" aria-hidden="true" tabindex="-1"></a>        <span class="at">se =</span> std.error,</span>
<span id="cb18-348"><a href="#cb18-348" aria-hidden="true" tabindex="-1"></a>        <span class="at">moe =</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> df) <span class="sc">*</span> se,</span>
<span id="cb18-349"><a href="#cb18-349" aria-hidden="true" tabindex="-1"></a>        <span class="at">u95 =</span> estimate <span class="sc">+</span> moe,</span>
<span id="cb18-350"><a href="#cb18-350" aria-hidden="true" tabindex="-1"></a>        <span class="at">l95 =</span> estimate <span class="sc">-</span> moe</span>
<span id="cb18-351"><a href="#cb18-351" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-352"><a href="#cb18-352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(term, estimate, se, l95, u95) <span class="sc">|&gt;</span></span>
<span id="cb18-353"><a href="#cb18-353" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>, <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-354"><a href="#cb18-354" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Term"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">hat{</span><span class="sc">\\</span><span class="st">beta}$"</span>, <span class="st">"$se(</span><span class="sc">\\</span><span class="st">hat{</span><span class="sc">\\</span><span class="st">beta})$"</span>,</span>
<span id="cb18-355"><a href="#cb18-355" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"LB 95% CI"</span>, <span class="st">"UB 95% CI"</span>))</span>
<span id="cb18-356"><a href="#cb18-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-357"><a href="#cb18-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-358"><a href="#cb18-358" aria-hidden="true" tabindex="-1"></a>We can take a look at the effects of the spin axis on the probability that a pitch will be a strike for each pitcher and their pitch types.</span>
<span id="cb18-359"><a href="#cb18-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-362"><a href="#cb18-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-363"><a href="#cb18-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: get-avg-pitch-vals</span></span>
<span id="cb18-364"><a href="#cb18-364" aria-hidden="true" tabindex="-1"></a>avg_pitches <span class="ot">&lt;-</span> pitches <span class="sc">|&gt;</span> </span>
<span id="cb18-365"><a href="#cb18-365" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(player_name, pitch_type) <span class="sc">|&gt;</span></span>
<span id="cb18-366"><a href="#cb18-366" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb18-367"><a href="#cb18-367" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_spin =</span> <span class="fu">mean</span>(cos_spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-368"><a href="#cb18-368" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_spin =</span> <span class="fu">mean</span>(sin_spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-369"><a href="#cb18-369" aria-hidden="true" tabindex="-1"></a>        <span class="at">cos_2spin =</span> <span class="fu">mean</span>(cos_2spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-370"><a href="#cb18-370" aria-hidden="true" tabindex="-1"></a>        <span class="at">sin_2spin =</span> <span class="fu">mean</span>(sin_2spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-371"><a href="#cb18-371" aria-hidden="true" tabindex="-1"></a>        <span class="at">release_speed =</span> <span class="fu">mean</span>(release_speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-372"><a href="#cb18-372" aria-hidden="true" tabindex="-1"></a>        <span class="at">release_extension =</span> <span class="fu">mean</span>(release_extension, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-373"><a href="#cb18-373" aria-hidden="true" tabindex="-1"></a>        <span class="at">rate_cos_spin =</span> <span class="fu">mean</span>(release_spin_rate <span class="sc">*</span> cos_spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-374"><a href="#cb18-374" aria-hidden="true" tabindex="-1"></a>        <span class="at">rate_sin_spin =</span> <span class="fu">mean</span>(release_spin_rate <span class="sc">*</span> sin_spin, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-375"><a href="#cb18-375" aria-hidden="true" tabindex="-1"></a>        <span class="at">plate_x =</span> <span class="fu">mean</span>(plate_x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-376"><a href="#cb18-376" aria-hidden="true" tabindex="-1"></a>        <span class="at">plate_z =</span> <span class="fu">mean</span>(plate_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-377"><a href="#cb18-377" aria-hidden="true" tabindex="-1"></a>        <span class="at">release_pos_x =</span> <span class="fu">mean</span>(release_pos_x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-378"><a href="#cb18-378" aria-hidden="true" tabindex="-1"></a>        <span class="at">release_pos_z =</span> <span class="fu">mean</span>(release_pos_x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-379"><a href="#cb18-379" aria-hidden="true" tabindex="-1"></a>        <span class="st">"release_pos_x:release_pos_z"</span> <span class="ot">=</span> <span class="fu">mean</span>(release_pos_x <span class="sc">*</span> release_pos_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-380"><a href="#cb18-380" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-381"><a href="#cb18-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-382"><a href="#cb18-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-385"><a href="#cb18-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-386"><a href="#cb18-386" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: glmm-fe</span></span>
<span id="cb18-387"><a href="#cb18-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-388"><a href="#cb18-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-389"><a href="#cb18-389" aria-hidden="true" tabindex="-1"></a>fe <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit<span class="sc">$</span>analyses[[<span class="dv">1</span>]])<span class="sc">$</span>player_name</span>
<span id="cb18-390"><a href="#cb18-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-391"><a href="#cb18-391" aria-hidden="true" tabindex="-1"></a>fe<span class="sc">$</span>player_name <span class="ot">&lt;-</span> <span class="fu">row.names</span>(fe)</span>
<span id="cb18-392"><a href="#cb18-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-393"><a href="#cb18-393" aria-hidden="true" tabindex="-1"></a>fe <span class="ot">&lt;-</span> fe <span class="sc">|&gt;</span></span>
<span id="cb18-394"><a href="#cb18-394" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb18-395"><a href="#cb18-395" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"pitch_type"</span>),</span>
<span id="cb18-396"><a href="#cb18-396" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"pitch_type"</span>,</span>
<span id="cb18-397"><a href="#cb18-397" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"re"</span></span>
<span id="cb18-398"><a href="#cb18-398" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-399"><a href="#cb18-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-400"><a href="#cb18-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-403"><a href="#cb18-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-404"><a href="#cb18-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prob-strike-glmm-est</span></span>
<span id="cb18-405"><a href="#cb18-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb18-406"><a href="#cb18-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-407"><a href="#cb18-407" aria-hidden="true" tabindex="-1"></a>p_strike <span class="ot">&lt;-</span> avg_pitches <span class="sc">|&gt;</span></span>
<span id="cb18-408"><a href="#cb18-408" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb18-409"><a href="#cb18-409" aria-hidden="true" tabindex="-1"></a>        <span class="at">pitch_type =</span> <span class="fu">paste0</span>(<span class="st">"pitch_type"</span>, pitch_type)</span>
<span id="cb18-410"><a href="#cb18-410" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-411"><a href="#cb18-411" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(fe, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"player_name"</span>, <span class="st">"pitch_type"</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_avg"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-412"><a href="#cb18-412" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb18-413"><a href="#cb18-413" aria-hidden="true" tabindex="-1"></a>        <span class="at">fe =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span> <span class="sc">+</span> cos_spin <span class="sc">*</span> cos_spin_avg <span class="sc">+</span> sin_spin <span class="sc">*</span> sin_spin_avg </span>
<span id="cb18-414"><a href="#cb18-414" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> cos_2spin <span class="sc">*</span> cos_2spin_avg <span class="sc">+</span> sin_2spin <span class="sc">*</span> sin_2spin_avg </span>
<span id="cb18-415"><a href="#cb18-415" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> release_speed <span class="sc">*</span> release_speed_avg <span class="sc">+</span> release_extension <span class="sc">*</span> release_extension_avg </span>
<span id="cb18-416"><a href="#cb18-416" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> rate_cos_spin <span class="sc">*</span> rate_cos_spin_avg <span class="sc">+</span> rate_sin_spin <span class="sc">*</span> rate_sin_spin_avg</span>
<span id="cb18-417"><a href="#cb18-417" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> plate_x <span class="sc">*</span> plate_x_avg <span class="sc">+</span> plate_z <span class="sc">*</span> plate_z_avg</span>
<span id="cb18-418"><a href="#cb18-418" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> release_pos_x <span class="sc">*</span> release_pos_x_avg </span>
<span id="cb18-419"><a href="#cb18-419" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> release_pos_z <span class="sc">*</span> release_pos_z_avg</span>
<span id="cb18-420"><a href="#cb18-420" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> <span class="st">`</span><span class="at">release_pos_x:release_pos_z</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">release_pos_x:release_pos_z_avg</span><span class="st">`</span>,</span>
<span id="cb18-421"><a href="#cb18-421" aria-hidden="true" tabindex="-1"></a>        <span class="at">logit =</span> fe <span class="sc">+</span> re,</span>
<span id="cb18-422"><a href="#cb18-422" aria-hidden="true" tabindex="-1"></a>        <span class="at">p_strike =</span> <span class="fu">plogis</span>(logit)</span>
<span id="cb18-423"><a href="#cb18-423" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-424"><a href="#cb18-424" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb18-425"><a href="#cb18-425" aria-hidden="true" tabindex="-1"></a>        player_name, pitch_type, logit, p_strike</span>
<span id="cb18-426"><a href="#cb18-426" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-427"><a href="#cb18-427" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb18-428"><a href="#cb18-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-429"><a href="#cb18-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-432"><a href="#cb18-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-433"><a href="#cb18-433" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-est-p-strike-glmm</span></span>
<span id="cb18-434"><a href="#cb18-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Estimated probability that each pitcher's pitch types will be a strike on average. </span></span>
<span id="cb18-435"><a href="#cb18-435" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(p_strike, <span class="fu">aes</span>(player_name, p_strike, <span class="at">color =</span> pitch_type)) <span class="sc">+</span></span>
<span id="cb18-436"><a href="#cb18-436" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-437"><a href="#cb18-437" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">25</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb18-438"><a href="#cb18-438" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"P(Strike)"</span>) <span class="sc">+</span></span>
<span id="cb18-439"><a href="#cb18-439" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb18-440"><a href="#cb18-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-441"><a href="#cb18-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-442"><a href="#cb18-442" aria-hidden="true" tabindex="-1"></a>In @fig-est-p-strike-glmm, the probability that each pitch type thrown by each pitcher will be a strike. We can see that Burnes and Miley are very unlikely to throw strikes. This makes sense for Miley since he tries to get weak contact (very effectively with a the lowest hard hit rate in MLB for SP at 31.1%, but a less stellar FIP of 4.69). In Burnes case, this may be a result of his pitches having a lot of movement resulting in more balls, and worked relatively well (FIP of 3.81 on the year, but 3.07 BB/9). Freddy Peralta and Colin Rea live in the zone with all or most of their pitch types being thrown for strikes on average. This worked well for Freddy in 2023, particularly in the second half of 2023 when he had a FIP of 2.92 (9th out of starters), and less well for Rea who had a FIP of 4.90 on the year. Woodruff and Houser were balanced in their approach.</span>
<span id="cb18-443"><a href="#cb18-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-444"><a href="#cb18-444" aria-hidden="true" tabindex="-1"></a>| Name             | K/9   | BB/9 | FIP  | HardHit% |</span>
<span id="cb18-445"><a href="#cb18-445" aria-hidden="true" tabindex="-1"></a>|------------------|-------|------|------|----------|</span>
<span id="cb18-446"><a href="#cb18-446" aria-hidden="true" tabindex="-1"></a>| Corbin Burnes    | 9.29  | 3.07 | 3.81 | 32.2%    |</span>
<span id="cb18-447"><a href="#cb18-447" aria-hidden="true" tabindex="-1"></a>| Adrian Houser    | 7.76  | 2.75 | 3.99 | 46.4%    |</span>
<span id="cb18-448"><a href="#cb18-448" aria-hidden="true" tabindex="-1"></a>| Wade Miley       | 5.91  | 2.84 | 4.69 | 31.1%    |</span>
<span id="cb18-449"><a href="#cb18-449" aria-hidden="true" tabindex="-1"></a>| Freddy Peralta   | 11.41 | 2.93 | 3.85 | 37.3%    |</span>
<span id="cb18-450"><a href="#cb18-450" aria-hidden="true" tabindex="-1"></a>| Colin Rea        | 7.94  | 2.74 | 4.90 | 43.2%    |</span>
<span id="cb18-451"><a href="#cb18-451" aria-hidden="true" tabindex="-1"></a>| Brandon Woodruff | 9.94  | 2.01 | 3.60 | 41.6%    |</span>
<span id="cb18-452"><a href="#cb18-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-453"><a href="#cb18-453" aria-hidden="true" tabindex="-1"></a>: 2023 Results</span>
<span id="cb18-454"><a href="#cb18-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-455"><a href="#cb18-455" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Modeling with brms --&gt;</span></span>
<span id="cb18-456"><a href="#cb18-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-459"><a href="#cb18-459" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-460"><a href="#cb18-460" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fit-brm-imps-norun</span></span>
<span id="cb18-461"><a href="#cb18-461" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb18-462"><a href="#cb18-462" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb18-463"><a href="#cb18-463" aria-hidden="true" tabindex="-1"></a><span class="co"># library(brms)</span></span>
<span id="cb18-464"><a href="#cb18-464" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-465"><a href="#cb18-465" aria-hidden="true" tabindex="-1"></a><span class="co"># brm_fit &lt;- brm_multiple(strike ~ cos_spin * pitch_type + sin_spin * pitch_type </span></span>
<span id="cb18-466"><a href="#cb18-466" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + cos_2spin * pitch_type + sin_2spin * pitch_type  </span></span>
<span id="cb18-467"><a href="#cb18-467" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + release_speed + release_extension </span></span>
<span id="cb18-468"><a href="#cb18-468" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + rate_cos_spin + rate_sin_spin</span></span>
<span id="cb18-469"><a href="#cb18-469" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + plate_x * plate_z + plate_x^2 + plate_z^2 </span></span>
<span id="cb18-470"><a href="#cb18-470" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + release_pos_x * release_pos_z</span></span>
<span id="cb18-471"><a href="#cb18-471" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + release_pos_x^2 + release_pos_z^2</span></span>
<span id="cb18-472"><a href="#cb18-472" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + (1 + pitch_type | player_name),</span></span>
<span id="cb18-473"><a href="#cb18-473" aria-hidden="true" tabindex="-1"></a><span class="co">#                               family = bernoulli(link = "logit"),</span></span>
<span id="cb18-474"><a href="#cb18-474" aria-hidden="true" tabindex="-1"></a><span class="co">#             data = imps,</span></span>
<span id="cb18-475"><a href="#cb18-475" aria-hidden="true" tabindex="-1"></a><span class="co">#             cores = 6,</span></span>
<span id="cb18-476"><a href="#cb18-476" aria-hidden="true" tabindex="-1"></a><span class="co">#             # threads = threading(6),</span></span>
<span id="cb18-477"><a href="#cb18-477" aria-hidden="true" tabindex="-1"></a><span class="co">#             chains = 2,</span></span>
<span id="cb18-478"><a href="#cb18-478" aria-hidden="true" tabindex="-1"></a><span class="co">#             refresh = 100,</span></span>
<span id="cb18-479"><a href="#cb18-479" aria-hidden="true" tabindex="-1"></a><span class="co">#             save_model = "log-reg-glmm-pitch.stan")</span></span>
<span id="cb18-480"><a href="#cb18-480" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-481"><a href="#cb18-481" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(brm_fit, file = "data/brms-glmm-fit.rds")</span></span>
<span id="cb18-482"><a href="#cb18-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-483"><a href="#cb18-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-486"><a href="#cb18-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-487"><a href="#cb18-487" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fit-brm-imps</span></span>
<span id="cb18-488"><a href="#cb18-488" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb18-489"><a href="#cb18-489" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb18-490"><a href="#cb18-490" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb18-491"><a href="#cb18-491" aria-hidden="true" tabindex="-1"></a><span class="co"># library(brms)</span></span>
<span id="cb18-492"><a href="#cb18-492" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-493"><a href="#cb18-493" aria-hidden="true" tabindex="-1"></a><span class="co"># brm_fit &lt;- brm_muliple(type ~ cos_spin * pitch_type + sin_spin * pitch_type </span></span>
<span id="cb18-494"><a href="#cb18-494" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + cos_2spin * pitch_type + sin_2spin * pitch_type  </span></span>
<span id="cb18-495"><a href="#cb18-495" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + release_speed + release_extension </span></span>
<span id="cb18-496"><a href="#cb18-496" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + rate_cos_spin + rate_sin_spin</span></span>
<span id="cb18-497"><a href="#cb18-497" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + plate_x * plate_z + plate_x^2 + plate_z^2 </span></span>
<span id="cb18-498"><a href="#cb18-498" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + release_pos_x * release_pos_z</span></span>
<span id="cb18-499"><a href="#cb18-499" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + release_pos_x^2 + release_pos_z^2</span></span>
<span id="cb18-500"><a href="#cb18-500" aria-hidden="true" tabindex="-1"></a><span class="co">#                               + (1 + pitch_type | player_name),</span></span>
<span id="cb18-501"><a href="#cb18-501" aria-hidden="true" tabindex="-1"></a><span class="co">#                               family = binomial(link = "logit"),</span></span>
<span id="cb18-502"><a href="#cb18-502" aria-hidden="true" tabindex="-1"></a><span class="co">#             data = imps)</span></span>
<span id="cb18-503"><a href="#cb18-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-504"><a href="#cb18-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-507"><a href="#cb18-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-508"><a href="#cb18-508" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-brm-fit</span></span>
<span id="cb18-509"><a href="#cb18-509" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb18-510"><a href="#cb18-510" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb18-511"><a href="#cb18-511" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb18-512"><a href="#cb18-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-513"><a href="#cb18-513" aria-hidden="true" tabindex="-1"></a><span class="co"># brm_fit &lt;- readRDS("data/brms-glmm-fit.rds")</span></span>
<span id="cb18-514"><a href="#cb18-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>